<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>å®¶åº­è¨˜å¸³é€š Pro+ é›²ç«¯ç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <script>
        // ==========================================
        // 1. å®‰å…¨èˆ‡ API é…ç½® (è«‹ä¿®æ”¹é€™è£¡)
        // ==========================================
        const APP_PASSWORD = "0825"; // è¨­å®šä¸€å€‹å®¶äººçŸ¥é“çš„å¯†ç¢¼
        const API_URL = "https://script.google.com/macros/s/AKfycbw7R8QEYDu4XHMSPqGl7vfwLA8QL1cursdlSLQ9ps3XDrjson1b8JZp3FP1i6Kz-oQ/exec"; // è²¼ä¸Šä½ çš„ Google Apps Script URL

        // ç°¡å–®å¯†ç¢¼æª¢æŸ¥é‚è¼¯
        function checkAccess() {
            let savedPass = localStorage.getItem('family_app_auth');
            while (savedPass !== APP_PASSWORD) {
                savedPass = prompt("ğŸ” é€™æ˜¯ç§äººæ‡‰ç”¨ï¼Œè«‹è¼¸å…¥å®¶åº­å­˜å–å¯†ç¢¼ï¼š");
                if (savedPass === null) {
                    document.body.innerHTML = "<div style='padding:50px; text-align:center;'>å­˜å–è¢«æ‹’çµ•ã€‚è«‹é‡æ–°æ•´ç†é é¢ã€‚</div>";
                    return false;
                }
                if (savedPass === APP_PASSWORD) {
                    localStorage.setItem('family_app_auth', savedPass);
                } else {
                    alert("âŒ å¯†ç¢¼éŒ¯èª¤ï¼");
                }
            }
            return true;
        }

        tailwind.config = {
            theme: {
                extend: { colors: { brand: { light: '#818cf8', DEFAULT: '#4f46e5', dark: '#3730a3' } }, padding: { 'safe': 'env(safe-area-inset-bottom)' } }
            }
        }
    </script>

    <style>
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #f3f4f6; -webkit-tap-highlight-color: transparent; overscroll-behavior-y: none; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .app-container { max-width: 480px; margin: 0 auto; background-color: #ffffff; min-height: 100vh; position: relative; box-shadow: 0 0 25px rgba(0,0,0,0.08); padding-bottom: calc(90px + env(safe-area-inset-bottom)); }
        .gradient-bg { background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%); }
        .input-style { background-color: #f9fafb; border: 1px solid #e5e7eb; transition: all 0.2s; }
        .input-style:focus { border-color: #6366f1; background-color: #fff; outline: none; box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1); }
        .modal { transition: opacity 0.2s ease; opacity: 0; pointer-events: none; z-index: 100; }
        .modal.active { opacity: 1; pointer-events: auto; }
        #loading-overlay { position: fixed; inset: 0; z-index: 9999; display: flex; justify-content: center; items-center; background: rgba(255,255,255,0.9); backdrop-filter: blur(4px); }
        #loading-overlay.hidden { display: none; }
        .spinner { border: 4px solid #f3f3f3; border-top: 4px solid #4f46e5; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .suggestion-box { position: absolute; background: white; border: 1px solid #e5e7eb; width: 100%; z-index: 40; border-radius: 0.5rem; max-height: 150px; overflow-y: auto; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
    </style>
</head>
<body onload="if(checkAccess()) loadRemoteData();">

<div id="loading-overlay">
    <div class="text-center">
        <div class="spinner mx-auto mb-3"></div>
        <p class="text-indigo-600 font-bold animate-pulse" id="loading-text">è³‡æ–™å®‰å…¨åŒæ­¥ä¸­...</p>
    </div>
</div>

<div class="app-container hide-scrollbar" id="app">
    
    <div id="top-nav-bar" class="fixed top-0 max-w-[480px] w-full z-20 flex justify-between items-center p-4 pointer-events-none transition-opacity duration-200">
        <div class="pointer-events-auto">
            <button onclick="openBackup()" class="w-10 h-10 bg-white/90 backdrop-blur rounded-full shadow-sm flex items-center justify-center text-gray-600 hover:text-green-600 transition">
                <i class="fas fa-cloud"></i>
            </button>
        </div>
        <button onclick="openSettings()" class="pointer-events-auto w-10 h-10 bg-white/90 backdrop-blur rounded-full shadow-sm flex items-center justify-center text-gray-600 hover:text-indigo-600 transition">
            <i class="fas fa-cog"></i>
        </button>
    </div>

    <div id="view-home" class="view-section">
        <div class="gradient-bg text-white pt-16 pb-8 px-6 rounded-b-[2.5rem] shadow-lg mb-4 relative overflow-hidden">
            <div class="text-center relative z-10">
                <p class="text-sm opacity-90 mb-1" id="home-title">æœ¬æœŸç¯©é¸ç¸½æ”¯å‡º</p>
                <div class="flex justify-center items-end gap-2">
                    <span class="text-lg opacity-80 mb-2">Â£</span>
                    <h2 class="text-5xl font-bold tracking-tight" id="home-total-gbp">0</h2>
                </div>
                <div class="mt-2 text-sm opacity-80 bg-white/20 inline-block px-3 py-1 rounded-full">
                    HK$ <span id="home-total-hkd">0</span>
                </div>
                <div id="member-stats" class="hidden mt-4 bg-white/10 rounded-xl p-3 text-sm flex justify-around"></div>
            </div>
        </div>

        <div class="px-4 mb-2 flex items-center justify-between">
            <h3 class="text-gray-800 font-bold text-lg">æ¶ˆè²»æ˜ç´°</h3>
            <button onclick="openFilterModal()" class="bg-white border border-gray-200 text-gray-600 px-3 py-2 rounded-full text-xs font-bold shadow-sm flex items-center gap-1 active:scale-95 transition">
                <i class="fas fa-filter"></i> ç¯©é¸
                <div id="filter-dot" class="hidden w-2 h-2 bg-red-500 rounded-full ml-1"></div>
            </button>
        </div>
        
        <div id="active-filters-bar" class="px-4 mb-4 flex flex-wrap gap-2"></div>
        <div class="px-4">
            <div id="expense-list" class="space-y-3 pb-24"></div>
        </div>
    </div>

    <div class="fixed bottom-0 left-0 right-0 bg-white/90 backdrop-blur-md border-t border-gray-100 px-6 pt-2 flex justify-between items-end max-w-[480px] mx-auto z-40" style="padding-bottom: env(safe-area-inset-bottom);">
        <button onclick="switchView('home')" class="nav-btn active flex flex-col items-center gap-1 w-1/3 text-indigo-600 pb-3"><i class="fas fa-list-ul text-xl"></i><span class="text-[10px]">æ˜ç´°</span></button>
        <div class="relative -top-5"><button onclick="switchView('add')" class="h-14 w-14 rounded-full gradient-bg text-white shadow-xl flex items-center justify-center transform hover:scale-105 active:scale-95 transition"><i class="fas fa-plus text-2xl"></i></button></div>
        <button onclick="switchView('split')" class="nav-btn flex flex-col items-center gap-1 w-1/3 hover:text-indigo-500 transition pb-3"><i class="fas fa-hand-holding-usd text-xl"></i><span class="text-[10px]">çµç®—</span></button>
    </div>
</div>

</body>
</html>